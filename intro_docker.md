## Kshare Docker導入仕様（確定版）

### 0. 目的

- ローカル開発環境をDockerで統一し、環境差（Node/依存/DB）を吸収する。
- `docker compose` で **web / api / db** をまとめて起動できるようにする。

---

## 1. 対象コンポーネント

### 1.1 docker compose で起動するサービス

- **db**：PostgreSQL（ローカルDB）
- **api**：Hono API（TypeScript）
- **web**：React + Vite（TanStack Router）

### 1.2 ローカルDBの扱い

- DBは **Postgresコンテナ**を採用する
- データは **volumeで永続化**する
- DBは **ホストへポート公開**する（ローカルツールから参照可能にする）

---

## 2. `/api` のつなぎ方（開発時）

- **方式A（確定）**：Vite dev server のプロキシで `/api/**` を **api** へ転送する
- フロントエンドは常に相対パスで **`/api/**`\*\* を叩く（環境でベースURLを変えない）
- 結果として開発時は「同一オリジン風」になり、CORSは基本不要

---

## 3. API（dev実行）

- APIの開発実行は **tsx** を使用する（watchで自動再起動）
- DB接続先は compose 内の `db` サービスを使う（ホスト名は `db`）

---

## 4. 依存管理（モノレポ）

- 依存インストールは **ルートで1回**に寄せる（モノレポ全体を対象）
- `packages/shared` を web / api が参照できるよう、コンテナはリポジトリ全体を扱う

---

## 5. `node_modules` の扱い

- `node_modules` は **コンテナ内に保持**する（ホストと共有しない）
- ソースコードはホストからバインドマウントし、ホットリロードを有効化する

---

## 6. マイグレーション運用

- マイグレーションは **手動ワンショット実行**を基本とする（起動時自動適用はしない）
- 実行窓口は **apiコンテナ経由**（例：`compose run api ...` の形）とする

---

## 7. 起動・確認要件

- `docker compose up` で以下が起動すること
  - db（Postgres）
  - api（tsx watch）
  - web（Vite dev server）

- 確認項目
  - web がブラウザから表示できる
  - web から `/api/health` 等が到達できる（Viteプロキシ経由）
  - DBへ接続でき、マイグレーションが適用できる

---

必要なら次は、この仕様をそのまま **「ディレクトリに何を置くか（ファイル構成）」**と **「初回セットアップ手順（実行順）」**に落とします。
